---
title: 'Ruby'
description: 'Ruby API SDK'

category: 'sdk'
layout: blank
---

Lo primero que debe hacer es instalar el *gem* del *WatchIoT ruby sdk*

## Install

{% highlight bash %}
$ gem install wiot-sdk
{% endhighlight %}

## Usage

Agregas la dependencia al *Gemfile*

{% highlight ruby %}
gem 'wiot-sdk'
{% endhighlight %}

Y ya puede utilizar el *sdk* en su agente

{% highlight ruby %}
require 'wiot-sdk'
{% endhighlight %}

Ahora tu tienes que inicializar el *client* pasandole el **username**, **api key**, **name space** and **name project**

{% highlight ruby %}
def init_sdk
    username = 'my_username'
    api_key = 'asd123asd-23asd-123sda-1231234saa'
    space = 'my_space'
    project = 'my_project'

    client = WiotSdk.init username, api_key, space, project
    client
end
{% endhighlight %}

La otra forma de inicializarlo es a traves de un fichero de configuracion que puede ser *.json* o *.yml*
{% highlight ruby %}
def init_sdk
    my_config_json = '/home/myhome/my_agent/my_agent.json'

    client = WiotSdk.init my_config_json
    client
end
{% endhighlight %}

{% highlight ruby %}
def init_sdk
    my_config_yml = '/home/myhome/my_agent/my_agent.yml'

    client = WiotSdk.init my_config_yml
    client
end
{% endhighlight %}

Ejemplo de fichero de configuracion

* json

{% highlight json %}
{
    "username": "my_username"
    "api_key": "asd123asd-23asd-123sda-1231234saa",
    "space"  : "my_space",
    "project": "my_project"
}
{% endhighlight %}

* yml

{% highlight yaml %}
username: "my_username"
api_key: "asd123asd-23asd-123sda-1231234saa"
space  : "my_space"
project: "my_project"
{% endhighlight %}

Una vez inicializado el cliente solo queda guardar los valores de las metricas y realizar la peticion al servidor
**WatchIoT API**

Solo resta recolectar las metricas utilizando la clase *Payload* del *SDK* utilizando el metodo *addMetric* donde se le
pasa el nombre de la metrica y el valor

{% highlight ruby %}
require 'wiot_sdk'

def collect
  puts '[*] collection metrics'

  payload = WiotSdk::Payload.new
  # metric :hd
  payload.addMetric(:hd, get_hd_value)
  # metric :free_space
  payload.addMetric(:free_space, get_free_space_value)

  payload
end

{% endhighlight %}

Una vez el cliente inicializado y las metricas recolectadas pasamos a realizar el *request* a **WatchIoT API**

{% highlight ruby %}
def request
    client = init_sdk
    payload = collect

    response = client.send payload
end
{% endhighlight %}

Si el servidor devuelve un *http code* distinto de 200 el *SDK* lanza una excepcion para eso debemos capturar la excepcion.

{% highlight ruby %}
def request
    client = init_sdk
    payload = collect
    
    begin
        response = client.send payload
    rescue WiotSdk::RequestError => e
        puts e.msg
    end
end
{% endhighlight %}
